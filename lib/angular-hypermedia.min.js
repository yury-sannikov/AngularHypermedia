/*!
 * angular-hypermedia 0.0.1-20140401
 * http://github.nreca.org/yxs0/angular-hypermedia
 */
"use strict";angular.module("angularHypermedia",[]).provider("Hypermedia",function(){var a={apiRoot:null,currentVersion:null,hypermediaFormat:"Siren"},b={};return{setUp:function(b){angular.extend(a,b)},getConfig:function(){return a},$get:["$injector",function(c){var d=function(){var d=c.get("$q"),e=c.get(a.hypermediaFormat),f=d.defer();if(angular.isObject(a.apiRoot)&&(b.data=e(a.apiRoot)),b.data)return f.resolve(b.data),f.promise;var g=c.get("$http");return g({method:"GET",url:a.apiRoot}).success(function(a){b.data=e(a),f.resolve(b.data)}).error(function(a){f.reject(a)}),f.promise};return{link:function(a,b){var e=c.get("$q"),f=e.defer();return d().then(function(c){c.link(a,b).then(function(a){f.resolve(a)},function(a){console.log(a),f.reject(a)})},function(a){console.log(a),f.reject(a)}),f.promise},getConfig:function(){return a}}}]}}),angular.module("angularHypermedia").provider("Siren",function(){var a={GetLinkUrlByRelVersion:function(a,b){b=b?"ver:"+b:"latest-version";var c=_.find(this.links,function(c){return-1!=_.indexOf(c.rel,a)&&-1!=_.indexOf(c.rel,b)});return c?c.url:void 0},CreateProperties:function(a){this.properties&&angular.forEach(this.properties,function(b,c){a[c]=b})},CreateEntities:function(a,b,c){if(this.entities){var d=b.get("$q"),e=b.get("$http"),f=function(a){var b=d.defer();return a.properties?(b.resolve(c(a)),b.promise):(e({method:"GET",url:a.href}).success(function(a){b.resolve(c(a))}).error(function(a){b.reject(a)}),b.promise)},g=function(a,b,c,d){var e,f;Object.defineProperty(a,b,{get:function(){return f||(f=!0,e=c.call(a,d)),e},enumerable:!0,configurable:!0})};angular.forEach(this.entities,function(b){angular.forEach(b.rel,function(c){g(a,c,f,b)})})}},$get:["$injector",function(b){var c=b.get("$q"),d=function(e){var f={link:function(e,g){var h=b.get("Hypermedia"),i=h.getConfig().currentVersion,j=a.GetLinkUrlByRelVersion.call(f.__$$data,e,g||i);if(!j)throw"Siren provider is unable to get link for rel "+e+" with version "+g;var k=b.get("$http"),l=c.defer();return k({method:"GET",url:j}).success(function(a){l.resolve(d(a))}).error(function(a){l.reject(a)}),l.promise}};return f.__$$data=e,a.CreateProperties.call(f.__$$data,f),a.CreateEntities.call(f.__$$data,f,b,d),f};return d}]};return a});